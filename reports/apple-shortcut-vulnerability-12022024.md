<div style="background-color: lightgrey; padding: 1px 5px">
<h2 align='center'>Apple Shortcuts Vulnerability Allows Easy Export of User Data</h2>
<h3 align='center'>Data Privacy / Apple Security</h4>
<div style="display:flex; flex-direction: row; text-align: center; margin-bottom: 20px;">
<p align='center'><b>Date: 12 March 2024</b></p>
<p align='center'><b>Authors: Jest, Peaks</b></p>
</div>
</div>

----

<div style='margin: 5px;'>
<h3>Introduction</h3>
<p>As reported in <a href='https://nvd.nist.gov/vuln/detail/CVE-2024-23204' target='_blank'>CVE-2024-23204</a> by Bitdefender security researcher Jubaer Alnazi Jabin, all Apple operating systems (i.e., macOS, iOS, iPadOS, watchOS) possessed a zero-click vulnerability in Shortcuts permitting base64 encoded messages to be transferred without explicit user consent (<a href='https://thehackernews.com/2024/02/researchers-detail-apples-recent-zero.html' target='_blank'>link</a>). This allowed for transfer of photos and videos without acute user confirmation.</p>

<p>Apple responded by pushing an update to Shortcuts app requiring user confirmation in the form of a Privacy pop-up window. Note that this confirmation step requires a simple click; it does not require knowledge (i.e., “something you know”) nor biometric data (i.e., “who you are”).</p>
<p align='center'><img src='/images/apple_shortcuts/shortcut_popup.jpeg' alt='response' width='35%;'></p>
<p>While the pop-up confirmation box is a low-level deterrent, it is insufficient in stopping attacks that leverage keylogger. Once a keylogger (or user) selects “Always Allow,” the pop-up confirmation window is satisfied, and any future attacks are performed without pop-up confirmation window.</p>

<h3>Attack Details</h3>
<p>Below is an example of a malicious Shortcut that easily bypasses Transparency, Consent, and Control (<a href='https://www.sentinelone.com/labs/bypassing-macos-tcc-user-privacy-protections-by-accident-and-design/' target='_blank'>TCC</a>) policies, post-vulnerability update by Apple:</p>

<table style='border:0px;'>
<tr>
<td width='40%'>Initial Shortcut Execution with Keylogger</td>
<td align='center'><img src='/images/apple_shortcuts/iPHONE_XR_DEPLOY.gif' alt='keylogger' width='60%;'></td>
</tr>
<tr>
<td>Remote Code Execution of Shortcuts Vulnerability with Data Exfiltration via SSH Tunneling</td>
<td align='center'><img src='/images/apple_shortcuts/rce_poc.png' alt='rce' width='60%;'></td>
</tr>
</table>

<p>This is to show, the zero-click Shortcuts vulnerability is inadequately patched. The solution implemented by Apple provides nothing more than an illusion of safety. Apple users remain equally vulnerable to attack.</p>
<p>Beyond photos and images stored both on-device and in the Cloud, this ongoing vulnerability permits exfiltration of much more personal data:</p>
<ul>
<li>Contacts (e.g., Name, Phone Number, Email Address, Home Address)</li>
<li>Calendar (e.g., Events and all details)</li>
<li>Media (e.g., Photos, Videos, Screenshots)</li>
<li>Notes</li>
<li>Files</li>
<li>Geolocation (e.g., GPS Coordinates, Stored Addresses, Pinned Locations)</li>
<li>Network Details (e.g., Internal & External IPv4 & IPv6 Addresses, WiFi Channels, Hotspot Password)</li>
<li>Hardware Details (e.g., Device Name, Hostname, System Version, MAC Address)</li>
</ul>
<p>
After submitting a detailed bug report to Apple on 24 February 2024, Apple classified this as a “non-security issue”:</p>

<p align='center'><img src='/images/apple_shortcuts/apple_response.png' alt='response' width='80%;'></p>

<p>We disagree. We again push Apple to consider the following suggestions for software hardening:</p>
<ul>
<li>Upgrade to a password and/or biometric-based confirmation step at the time of shortcut execution.</li>
<li>Upgrade Shortcuts configuration settings to include a “locked” mode requiring successful completion of two-factor authentication.</li>
</ul>

<h3>Defending</h3>

To confirm if your phone is subject to Shortcuts-based attacks, first check whether the following Shortcuts settings (Settings > Shortcuts) are “on” or “off”: 
<p align='center'><img src='/images/apple_shortcuts/shortcut_setting.png' alt='setting' width='35%;'></p>
<p>Under Shortcuts Advanced settings (Settings > Shortcuts > Advanced):</p>
<p align='center'><img src='/images/apple_shortcuts/shortcut_setting_adv.png' alt='setting-adv' width='35%;'></p>

<p>If any settings are toggled “on” (in green), consider toggling the setting off. Next, in the Shortcuts app, review the list of Shortcuts on your device, checking for the addition of any new or suspicious items.</p>
<p>As general precaution, we discourage persons from using charging cables you do not own or are unfamiliar with, as they could be malicious (e.g., <a href='https://shop.hak5.org/products/omg-cable' target='_blank'>Hak5 O.MG Cable</a>). Additionally, because tools such as <a href='https://flipperzero.one/' target='_blank'>FlipperZero</a> can execute Bluetooth-based attacks (e.g., <a href='https://www.bleepingcomputer.com/news/security/flipper-zero-can-be-used-to-launch-ios-bluetooth-spam-attacks/' target='_b;ank'>FlipperZero iOS Bluetooth Spam Attack</a>), we encourage persons to toggle Bluetooth “off” when not in use. We strongly suggest removing Bluetooth keyboard devices from “My Devices” list under Bluetooth Settings. Finally, we note that the Bluetooth protocol itself is especially vulnerable to attack (e.g., <a href='https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-45866' target='_blank'>CVE-2023-45866</a>). We encourage persons refrain from using Bluetooth devices as much as possible. Devices with cords are safer; embrace the cord.</p>
</div>
